var Game={SCORE_PLUS_1:1,SCORE_PLUS_2:3,SCORE_PLUS_3:5,SCORE_PLUS_4:11,LEVEL_SCORE:100,DEFAULT_DOWN_INTERVAL:500,DOWN_INTERVAL_CHANGE:45,ANI:false,m_ground:Array(10),m_base:Array(10),m_curBlock:null,m_running:false,m_paused:false,m_effecting:false,m_isGameOver:false,m_iScore:0,m_nLevel:0,m_nInitLevel:0,m_nextType:-1,m_cheat:false,m_isAutoUpBase:0,m_curColor:0,m_lastTime:0,m_cumulativeTime:0,m_gameUI:null,m_downTimer:null,m_upBaseTimer:null,m_s:0,m_downToBaseInterval:0,Init:function(c){Game.m_running=
false;Game.m_effecting=false;Game.m_iScore=0;Game.m_nLevel=0;Game.m_nInitLevel=0;Game.m_nextType=-1;Game.m_paused=false;Game.m_cheat=false;Game.m_isAutoUpBase=0;Game.m_gameUI=c;for(c=0;c<10;++c)Game.m_ground[c]=Array(20),Game.m_base[c]=Array(23);Game.m_curBlock=null;for(c=0;c<10;c++)for(var a=0;a<23;a++)a<20&&(Game.m_ground[c][a]=0),Game.m_base[c][a]=0;Game.m_nextType=Game.GenType()},GenType:function(){for(var c=-1,a=-1;a<0||a>19;)a=Math.floor(Math.random()*26-5);switch(a){case 0:case 1:case 2:c=
6;break;case 3:case 4:case 5:c=2;break;case 6:case 7:case 8:c=3;break;case 9:case 10:c=1;break;case 11:case 12:case 13:c=4;break;case 14:case 15:case 16:c=0;break;case 17:case 18:case 19:c=5}return c},NewCurBlock:function(){if(Game.m_running&&!Game.m_paused){var c=Game.m_effecting=false;if(Game.m_curBlock!=null){if(Game.BlockDownOnBase())return Game.Stop(),true;Game.m_curBlock=null}var a=Game.m_nextType;Game.m_nextType=-1;Game.m_nextType=Game.GenType();var e=new Pos;switch(a){case 0:if(Game.m_base[4][19]>
0||Game.m_base[5][19]>0||Game.m_base[4][18]>0||Game.m_base[5][18]>0)c=true;e.x=4;e.y=18;Game.m_curBlock=new Block(a,e);break;case 1:if(Game.m_base[3][19]>0||Game.m_base[4][19]>0||Game.m_base[5][19]>0||Game.m_base[6][19]>0)c=true;e.x=3;e.y=19;Game.m_curBlock=new Block(a,e);break;case 2:if(Game.m_base[4][18]>0||Game.m_base[3][19]>0||Game.m_base[4][19]>0||Game.m_base[5][19]>0)c=true;e.x=4;e.y=18;Game.m_curBlock=new Block(a,e);break;case 3:if(Game.m_base[4][18]>0||Game.m_base[5][18]>0||Game.m_base[6][18]>
0||Game.m_base[4][19]>0)c=true;e.x=4;e.y=18;Game.m_curBlock=new Block(a,e);break;case 4:if(Game.m_base[4][18]>0||Game.m_base[5][18]>0||Game.m_base[6][18]>0||Game.m_base[6][19]>0)c=true;e.x=4;e.y=18;Game.m_curBlock=new Block(a,e);break;case 5:if(Game.m_base[4][18]>0||Game.m_base[5][18]>0||Game.m_base[3][19]>0||Game.m_base[4][19]>0)c=true;e.x=4;e.y=18;Game.m_curBlock=new Block(a,e);break;case 6:if(Game.m_base[4][18]>0||Game.m_base[5][18]>0||Game.m_base[5][19]>0||Game.m_base[6][19]>0)c=true;e.x=4;e.y=
18;Game.m_curBlock=new Block(a,e)}Game.m_curColor>=0&&Game.m_curColor<5?Game.m_curColor++:Game.m_curColor=1;Game.m_curBlock.setColor(Game.m_curColor);Game.m_effecting||Game.m_gameUI.repaint();if(c)Game.m_running=false;return c}return false},Display:function(){for(var c=0;c<10;c++)for(var a=0;a<20;a++)Game.m_ground[c][a]=Game.m_base[c][a];if(Game.m_curBlock!=null&&Game.m_running){var c=Game.m_curBlock.GetType(),a=Game.m_curBlock.GetPos(),e=Game.m_curBlock.GetStyle(),b=Game.m_curBlock.getColor();switch(c){case 0:Game.m_ground[a.x][a.y]=
b;Game.m_ground[a.x+1][a.y]=b;Game.m_ground[a.x][a.y+1]=b;Game.m_ground[a.x+1][a.y+1]=b;break;case 1:switch(e){case 0:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b,Game.m_ground[a.x+2][a.y]=b,Game.m_ground[a.x+3][a.y]=b);break;case 1:a.y<20&&(Game.m_ground[a.x][a.y]=b),a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b),a.y+2<20&&(Game.m_ground[a.x][a.y+2]=b),a.y+3<20&&(Game.m_ground[a.x][a.y+3]=b)}break;case 2:switch(e){case 0:a.y<20&&(Game.m_ground[a.x][a.y]=b);a.y+1<20&&(Game.m_ground[a.x-
1][a.y+1]=b,Game.m_ground[a.x][a.y+1]=b,Game.m_ground[a.x+1][a.y+1]=b);break;case 1:a.y<20&&(Game.m_ground[a.x][a.y]=b);a.y+1<20&&(Game.m_ground[a.x-1][a.y+1]=b,Game.m_ground[a.x][a.y+1]=b);a.y+2<20&&(Game.m_ground[a.x][a.y+2]=b);break;case 2:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b,Game.m_ground[a.x+2][a.y]=b);a.y+1<20&&(Game.m_ground[a.x+1][a.y+1]=b);break;case 3:a.y<20&&(Game.m_ground[a.x][a.y]=b),a.y+1<20&&(Game.m_ground[a.x+1][a.y+1]=b,Game.m_ground[a.x][a.y+1]=b),a.y+2<
20&&(Game.m_ground[a.x][a.y+2]=b)}break;case 3:switch(e){case 0:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b,Game.m_ground[a.x+2][a.y]=b);a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b);break;case 1:a.y<20&&(Game.m_ground[a.x][a.y]=b);a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b);a.y+2<20&&(Game.m_ground[a.x][a.y+2]=b,Game.m_ground[a.x+1][a.y+2]=b);break;case 2:a.y<20&&(Game.m_ground[a.x][a.y]=b);a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b,Game.m_ground[a.x-2][a.y+1]=b,Game.m_ground[a.x-1][a.y+1]=
b);break;case 3:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b),a.y+1<20&&(Game.m_ground[a.x+1][a.y+1]=b),a.y+2<20&&(Game.m_ground[a.x+1][a.y+2]=b)}break;case 4:switch(e){case 0:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b,Game.m_ground[a.x+2][a.y]=b);a.y+1<20&&(Game.m_ground[a.x+2][a.y+1]=b);break;case 1:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b);a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b);a.y+2<20&&(Game.m_ground[a.x][a.y+2]=b);break;case 2:a.y<
20&&(Game.m_ground[a.x][a.y]=b);a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b,Game.m_ground[a.x+1][a.y+1]=b,Game.m_ground[a.x+2][a.y+1]=b);break;case 3:a.y<20&&(Game.m_ground[a.x][a.y]=b),a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b),a.y+2<20&&(Game.m_ground[a.x][a.y+2]=b,Game.m_ground[a.x-1][a.y+2]=b)}break;case 5:switch(e){case 0:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b);a.y+1<20&&(Game.m_ground[a.x-1][a.y+1]=b,Game.m_ground[a.x][a.y+1]=b);break;case 1:a.y<20&&(Game.m_ground[a.x][a.y]=
b),a.y+1<20&&(Game.m_ground[a.x][a.y+1]=b,Game.m_ground[a.x+1][a.y+1]=b),a.y+2<20&&(Game.m_ground[a.x+1][a.y+2]=b)}break;case 6:switch(e){case 0:a.y<20&&(Game.m_ground[a.x][a.y]=b,Game.m_ground[a.x+1][a.y]=b);a.y+1<20&&(Game.m_ground[a.x+1][a.y+1]=b,Game.m_ground[a.x+2][a.y+1]=b);break;case 1:a.y<20&&(Game.m_ground[a.x][a.y]=b),a.y+1<20&&(Game.m_ground[a.x-1][a.y+1]=b,Game.m_ground[a.x][a.y+1]=b),a.y+2<20&&(Game.m_ground[a.x-1][a.y+2]=b)}}}return Game.m_ground},BlockHMove:function(c){if(Game.m_curBlock!=
null&&Game.m_running&&!Game.m_paused&&!Game.m_effecting){var a=Game.m_curBlock.GetType(),e=Game.m_curBlock.GetPos(),b=Game.m_curBlock.GetStyle(),d=false,f=c;c<0&&(d=true,f=-c);newPos=new Pos;newPos.x=e.x;newPos.y=e.y;for(e=0;e<f;e++)switch(d?newPos.x-=1:newPos.x+=1,a){case 0:if(newPos.x>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x+1][newPos.y]==0&&Game.m_base[newPos.x+1][newPos.y+1]==0))return true}else return true;break;case 1:switch(b){case 0:if(newPos.x>=
0&&newPos.x+3<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x+3][newPos.y]==0))return true}else return true;break;case 1:if(newPos.x>=0&&newPos.x<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x][newPos.y+2]==0&&Game.m_base[newPos.x][newPos.y+3]==0))return true}else return true}break;case 2:switch(b){case 0:if(newPos.x-1>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x-1][newPos.y+1]==0&&Game.m_base[newPos.x+
1][newPos.y+1]==0))return true}else return true;break;case 1:if(newPos.x-1>=0&&newPos.x<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x-1][newPos.y+1]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x][newPos.y+2]==0))return true}else return true;break;case 2:if(newPos.x>=0&&newPos.x+2<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x+1][newPos.y+1]==0&&Game.m_base[newPos.x+2][newPos.y]==0))return true}else return true;break;case 3:if(newPos.x>=0&&newPos.x+
1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x+1][newPos.y+1]==0&&Game.m_base[newPos.x][newPos.y+2]==0))return true}else return true}break;case 3:switch(b){case 0:if(newPos.x>=0&&newPos.x+2<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x+2][newPos.y]==0))return true}else return true;break;case 1:if(newPos.x>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+
1]==0&&Game.m_base[newPos.x][newPos.y+2]==0&&Game.m_base[newPos.x+1][newPos.y+2]==0))return true}else return true;break;case 2:if(newPos.x-2>=0&&newPos.x<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x-2][newPos.y+1]==0))return true}else return true;break;case 3:if(newPos.x>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x+1][newPos.y]==0&&Game.m_base[newPos.x+1][newPos.y+1]==0&&Game.m_base[newPos.x+1][newPos.y+
2]==0))return true}else return true}break;case 4:switch(b){case 0:if(newPos.x>=0&&newPos.x+2<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x+2][newPos.y]==0&&Game.m_base[newPos.x+2][newPos.y+1]==0))return true}else return true;break;case 1:if(newPos.x>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x][newPos.y+2]==0&&Game.m_base[newPos.x+1][newPos.y]==0))return true}else return true;break;case 2:if(newPos.x>=0&&
newPos.x+2<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x+2][newPos.y+1]==0))return true}else return true;break;case 3:if(newPos.x-1>=0&&newPos.x<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x][newPos.y+2]==0&&Game.m_base[newPos.x-1][newPos.y+2]==0))return true}else return true}break;case 5:switch(b){case 0:if(newPos.x-1>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+
1]==0&&Game.m_base[newPos.x-1][newPos.y+1]==0&&Game.m_base[newPos.x+1][newPos.y]==0))return true}else return true;break;case 1:if(newPos.x>=0&&newPos.x+1<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x+1][newPos.y+1]==0&&Game.m_base[newPos.x+1][newPos.y+2]==0))return true}else return true}break;case 6:switch(b){case 0:if(newPos.x>=0&&newPos.x+2<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x+1][newPos.y]==0&&Game.m_base[newPos.x+
1][newPos.y+1]==0&&Game.m_base[newPos.x+2][newPos.y+1]==0))return true}else return true;break;case 1:if(newPos.x-1>=0&&newPos.x<=9){if(!(Game.m_base[newPos.x][newPos.y]==0&&Game.m_base[newPos.x][newPos.y+1]==0&&Game.m_base[newPos.x-1][newPos.y+1]==0&&Game.m_base[newPos.x-1][newPos.y+2]==0))return true}else return true}}if(e==f)return Game.m_curBlock.MoveX(c),false}return true},BlockVMove:function(c){if(Game.m_curBlock!=null&&Game.m_running&&!Game.m_paused&&!Game.m_effecting){var a=Game.m_curBlock.GetType(),
e=Game.m_curBlock.GetPos(),b=Game.m_curBlock.GetStyle(),d=new Pos;d.x=e.x;d.y=e.y;d.y+=c;if(d.y<0)return true;switch(a){case 0:if(Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==0)return Game.m_curBlock.Down(),false;else break;case 1:switch(b){case 0:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==0&&Game.m_base[d.x+2][d.y]==0&&Game.m_base[d.x+3][d.y]==0?(Game.m_curBlock.Down(),false):true;case 1:return Game.m_base[d.x][d.y]==0?(Game.m_curBlock.Down(),false):true}break;case 2:switch(b){case 0:return Game.m_base[d.x][d.y]==
0&&Game.m_base[d.x-1][d.y+1]==0&&Game.m_base[d.x+1][d.y+1]==0?(Game.m_curBlock.Down(),false):true;case 1:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x-1][d.y+1]==0?(Game.m_curBlock.Down(),false):true;case 2:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==0&&Game.m_base[d.x+2][d.y]==0?(Game.m_curBlock.Down(),false):true;case 3:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y+1]==0?(Game.m_curBlock.Down(),false):true}break;case 3:switch(b){case 0:return Game.m_base[d.x][d.y]==0&&
Game.m_base[d.x+1][d.y]==0&&Game.m_base[d.x+2][d.y]==0?(Game.m_curBlock.Down(),false):true;case 1:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y+2]==0?(Game.m_curBlock.Down(),false):true;case 2:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x-1][d.y+1]==0&&Game.m_base[d.x-2][d.y+1]==0?(Game.m_curBlock.Down(),false):true;case 3:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==0?(Game.m_curBlock.Down(),false):true}break;case 4:switch(b){case 0:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+
1][d.y]==0&&Game.m_base[d.x+2][d.y]==0?(Game.m_curBlock.Down(),false):true;case 1:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==0?(Game.m_curBlock.Down(),false):true;case 2:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y+1]==0&&Game.m_base[d.x+2][d.y+1]==0?(Game.m_curBlock.Down(),false):true;case 3:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x-1][d.y+2]==0?(Game.m_curBlock.Down(),false):true}break;case 5:switch(b){case 0:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==
0&&Game.m_base[d.x-1][d.y+1]==0?(Game.m_curBlock.Down(),false):true;case 1:return Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y+1]==0?(Game.m_curBlock.Down(),false):true}break;case 6:switch(b){case 0:if(Game.m_base[d.x][d.y]==0&&Game.m_base[d.x+1][d.y]==0&&Game.m_base[d.x+2][d.y+1]==0)return Game.m_curBlock.Down(),false;else break;case 1:if(Game.m_base[d.x][d.y]==0&&Game.m_base[d.x-1][d.y+1]==0)return Game.m_curBlock.Down(),false}}}return true},BlockRotate:function(){if(Game.m_curBlock!=null&&
Game.m_running&&!Game.m_paused&&!Game.m_effecting){var c=Game.m_curBlock.GetType(),a=Game.m_curBlock.GetPos(),e=Game.m_curBlock.GetStyle();switch(c){case 0:return true;case 1:switch(e){case 0:return Game.m_base[a.x+1][a.y+1]>0||Game.m_base[a.x+1][a.y+2]>0||Game.m_base[a.x+1][a.y+3]>0?true:(Game.m_curBlock.MoveX(1),Game.m_curBlock.Rotate(),false);case 1:if(a.x+1>9||Game.m_base[a.x+1][a.y]>0){if(Game.BlockHMove(-3))return true}else if(a.x+2>9||Game.m_base[a.x+2][a.y]>0){if(Game.BlockHMove(-2))return true}else if(a.x+
3>9||Game.m_base[a.x+3][a.y]>0){if(Game.BlockHMove(-1))return true}else if(a.x-1<0||Game.m_base[a.x-1][a.y]>0){if(Game.BlockHMove(3))return true;Game.m_curBlock.MoveX(-3)}else if(Game.BlockHMove(-1))return true;Game.m_curBlock.Rotate();return false}case 2:switch(e){case 0:return Game.m_base[a.x][a.y+2]>0?true:(Game.m_curBlock.Rotate(),false);case 1:if(a.x+1>9||Game.m_base[a.x+1][a.y]>0||Game.m_base[a.x+1][a.y+1]>0||Game.m_base[a.x+1][a.y+2]>0){if(Game.BlockHMove(-1))return true}else if(Game.m_base[a.x-
1][a.y]>0&&Game.BlockHMove(1))return true;Game.m_curBlock.MoveX(-1);Game.m_curBlock.Rotate();return false;case 2:if(Game.m_base[a.x+1][a.y+2]>0||Game.m_base[a.x+2][a.y+1]>0)return true;Game.m_curBlock.MoveX(1);Game.m_curBlock.Rotate();return false;case 3:if((a.x-1<0||Game.m_base[a.x-1][a.y+1]>0)&&Game.BlockHMove(1))return true;Game.m_curBlock.Rotate();return false}break;case 3:switch(e){case 0:return Game.m_base[a.x+1][a.y+1]>0||Game.m_base[a.x+1][a.y+2]>0||Game.m_base[a.x+2][a.y+2]>0?true:(Game.m_curBlock.Rotate(),
Game.m_curBlock.MoveX(1),false);case 1:if(a.x-1<0||Game.m_base[a.x-1][a.y+1]>0||Game.m_base[a.x-1][a.y]>0){if(Game.BlockHMove(1))return true;a=Game.m_curBlock.GetPos();if(Game.m_base[a.x+1][a.y]>0||Game.m_base[a.x+1][a.y+1]>0)return Game.BlockHMove(-1),true;Game.m_curBlock.Rotate();Game.m_curBlock.MoveX(1);return false}else return Game.m_base[a.x+1][a.y]>0||Game.m_base[a.x+1][a.y+1]>0?true:(Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(1),false);case 2:return Game.m_base[a.x-1][a.y]>0||Game.m_base[a.x-
1][a.y+2]>0||Game.m_base[a.x-2][a.y]>0||Game.m_base[a.x-2][a.y+2]>0?true:(Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(-2),false);case 3:if(a.x+2>9||Game.m_base[a.x+2][a.y]>0||Game.m_base[a.x+2][a.y+1]>0||Game.m_base[a.x+2][a.y+2]>0){if(Game.BlockHMove(-1))return true;a=Game.m_curBlock.GetPos();if(Game.m_base[a.x][a.y+1]>0)return Game.BlockHMove(1),true;Game.m_curBlock.Rotate()}else return Game.m_base[a.x][a.y+1]>0?true:(Game.m_curBlock.Rotate(),false)}break;case 4:switch(e){case 0:return Game.m_base[a.x+
1][a.y+1]>0||Game.m_base[a.x+1][a.y+2]>0?true:(Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(1),false);case 1:if(a.x-1<0||Game.m_base[a.x-1][a.y+1]>0||Game.m_base[a.x-1][a.y]>0){if(Game.BlockHMove(1))return true;a=Game.m_curBlock.GetPos();if(Game.m_base[a.x+1][a.y+1]>0)return Game.BlockHMove(-1),true;Game.m_curBlock.Rotate();Game.m_curBlock.MoveX(-1);return false}else return Game.m_base[a.x+1][a.y+1]>0?true:(Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(-1),false);case 2:return Game.m_base[a.x][a.y+
2]>0||Game.m_base[a.x+1][a.y]>0||Game.m_base[a.x+1][a.y+2]>0||Game.m_base[a.x+2][a.y]>0?true:(Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(1),false);case 3:if(a.x+2>9||Game.m_base[a.x+1][a.y]>0||Game.m_base[a.x+1][a.y+1]>0||Game.m_base[a.x+1][a.y+2]>0){if(Game.BlockHMove(-1))return true;a=Game.m_curBlock.GetPos();if(Game.m_base[a.x-1][a.y]>0)return Game.BlockHMove(1),true;Game.m_curBlock.Rotate();Game.m_curBlock.MoveX(-1)}else return Game.m_base[a.x-1][a.y]>0?true:(Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(-1),
false)}break;case 5:switch(e){case 0:return Game.m_base[a.x+1][a.y+1]>0||Game.m_base[a.x+1][a.y+2]>0?true:(Game.m_curBlock.Rotate(),false);case 1:if(a.x-1<0||Game.m_base[a.x-1][a.y]>0||Game.m_base[a.x-1][a.y+1]>0){if(Game.BlockHMove(1))return true;a=Game.m_curBlock.GetPos();if(Game.m_base[a.x+1][a.y]>0)return Game.BlockHMove(-1),true;Game.m_curBlock.Rotate();return false}else return Game.m_base[a.x+1][a.y]>0?true:(Game.m_curBlock.Rotate(),false)}break;case 6:switch(e){case 0:if(Game.m_base[a.x][a.y+
1]>0||Game.m_base[a.x][a.y+2]>0)return true;else{Game.m_curBlock.Rotate();Game.m_curBlock.MoveX(1);break}case 1:if(a.x+1>9||Game.m_base[a.x+1][a.y]>0||Game.m_base[a.x+1][a.y+1]>0){if(Game.BlockHMove(-1))return true;a=Game.m_curBlock.GetPos();if(Game.m_base[a.x-1][a.y]>0)return Game.BlockHMove(1),true;Game.m_curBlock.Rotate();Game.m_curBlock.MoveX(-1)}else if(Game.m_base[a.x-1][a.y]>0)return true;else Game.m_curBlock.Rotate(),Game.m_curBlock.MoveX(-1)}}}return false},BlockDownOnBase:function(){if(Game.m_curBlock!=
null&&Game.m_running&&!Game.m_paused&&!Game.m_effecting){var c=Game.m_curBlock.GetType(),a=Game.m_curBlock.GetPos(),e=Game.m_curBlock.GetStyle(),b=Game.m_curBlock.getColor();switch(c){case 0:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b,Game.m_base[a.x+1][a.y+1]=b;else return true;break;case 1:switch(e){case 0:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b,Game.m_base[a.x+2][a.y]=b,Game.m_base[a.x+3][a.y]=b;else return true;
break;case 1:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x][a.y+2]=b;else return true;if(a.y+3<20)Game.m_base[a.x][a.y+3]=b;else return true}break;case 2:switch(e){case 0:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x-1][a.y+1]=b,Game.m_base[a.x][a.y+1]=b,Game.m_base[a.x+1][a.y+1]=b;else return true;break;case 1:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x-
1][a.y+1]=b,Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x][a.y+2]=b;else return true;break;case 2:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b,Game.m_base[a.x+2][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x+1][a.y+1]=b;else return true;break;case 3:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x+1][a.y+1]=b,Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x][a.y+2]=b;else return true}break;case 3:switch(e){case 0:if(a.y<
20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b,Game.m_base[a.x+2][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b;else return true;break;case 1:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x][a.y+2]=b,Game.m_base[a.x+1][a.y+2]=b;else return true;break;case 2:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b,Game.m_base[a.x-2][a.y+1]=b,Game.m_base[a.x-1][a.y+
1]=b;else return true;break;case 3:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x+1][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x+1][a.y+2]=b;else return true}break;case 4:switch(e){case 0:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b,Game.m_base[a.x+2][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x+2][a.y+1]=b;else return true;break;case 1:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b;else return true;
if(a.y+1<20)Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x][a.y+2]=b;else return true;break;case 2:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b,Game.m_base[a.x+1][a.y+1]=b,Game.m_base[a.x+2][a.y+1]=b;else return true;break;case 3:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x][a.y+2]=b,Game.m_base[a.x-1][a.y+2]=b;else return true}break;case 5:switch(e){case 0:if(a.y<
20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x-1][a.y+1]=b,Game.m_base[a.x][a.y+1]=b;else return true;break;case 1:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x][a.y+1]=b,Game.m_base[a.x+1][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x+1][a.y+2]=b;else return true}break;case 6:switch(e){case 0:if(a.y<20)Game.m_base[a.x][a.y]=b,Game.m_base[a.x+1][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x+1][a.y+1]=
b,Game.m_base[a.x+2][a.y+1]=b;else return true;break;case 1:if(a.y<20)Game.m_base[a.x][a.y]=b;else return true;if(a.y+1<20)Game.m_base[a.x-1][a.y+1]=b,Game.m_base[a.x][a.y+1]=b;else return true;if(a.y+2<20)Game.m_base[a.x-1][a.y+2]=b;else return true}}c=[];a=0;for(e=19;e>=0;e--){for(var b=true,d=0;d<10;d++)if(Game.m_base[d][e]==0){b=false;break}b&&(a++,c.push(e))}a>0&&(Game.ANI?(clearTimeout(Game.m_downTimer),Game.setEffecting(true),a=Game.Display(),Game.m_gameUI.dispearLinesEffect(c,a,function(a,
b){Game.AfterDispear(a,b);Game.setEffecting(false);Game.DownThread()})):Game.AfterDispear(c,a))}return false},AfterDispear:function(c,a){for(var e=c.length,b=0;b<e;b++)for(var d=c[b];d<20;++d)for(var f=0;f<10;f++)Game.m_base[f][d]=Game.m_base[f][d+1];switch(a){case 1:Game.m_iScore+=Game.SCORE_PLUS_1+Game.m_nLevel+Game.m_isAutoUpBase;break;case 2:Game.m_iScore+=Game.SCORE_PLUS_2+Game.m_nLevel+Game.m_isAutoUpBase;break;case 3:Game.m_iScore+=Game.SCORE_PLUS_3+Game.m_nLevel+Game.m_isAutoUpBase;break;
case 4:Game.m_iScore+=Game.SCORE_PLUS_4+Game.m_nLevel+Game.m_isAutoUpBase}Game.m_iScore=Math.floor(Game.m_iScore);if(a>0&&Game.m_nLevel<9)Game.m_nLevel=Game.m_nInitLevel+Game.m_iScore/Game.LEVEL_SCORE,Game.m_nLevel=Math.floor(Game.m_nLevel)},IsRunning:function(){return Game.m_running},GetScore:function(){return Game.m_iScore},GetLevel:function(){return Game.m_nLevel},SetInitLevel:function(c){if(c<=9)Game.m_nInitLevel=c},GetNext:function(){for(var c=Array(4),a=0;a<4;++a)c[a]=Array(2);for(a=0;a<4;a++)for(var e=
0;e<2;e++)c[a][e]=0;if(!Game.m_running)return{type:Game.m_nextType,array:c};switch(Game.m_nextType){case 0:c[1][1]=1;c[2][1]=1;c[1][0]=1;c[2][0]=1;break;case 1:c[0][0]=1;c[1][0]=1;c[2][0]=1;c[3][0]=1;break;case 2:c[1][1]=1;c[0][0]=1;c[1][0]=1;c[2][0]=1;break;case 3:c[0][1]=1;c[0][0]=1;c[1][0]=1;c[2][0]=1;break;case 4:c[2][1]=1;c[0][0]=1;c[1][0]=1;c[2][0]=1;break;case 5:c[0][1]=1;c[1][1]=1;c[1][0]=1;c[2][0]=1;break;case 6:c[1][1]=1,c[2][1]=1,c[0][0]=1,c[1][0]=1}return{type:Game.m_nextType,array:c}},
GetPlayingTime:function(){var c=Math.floor((new Date).getTime()/1E3);Game.m_lastTime<=0||(Game.m_cumulativeTime+=c-Game.m_lastTime);Game.m_lastTime=c;return Game.m_cumulativeTime},KeyDownPressed:function(){Game.m_effecting||(Game.BlockVMove(-1)&&Game.NewCurBlock()&&Game.Stop(),Game.m_effecting||Game.m_gameUI.repaint())},KeyLeftPressed:function(){Game.BlockHMove(-1)||Game.m_gameUI.repaint()},KeyRightPressed:function(){Game.BlockHMove(1)||Game.m_gameUI.repaint()},KeyDownToBasePressed:function(){for(;!Game.BlockVMove(-1););
Game.m_gameUI.repaint()},KeyRotatePressed:function(){Game.BlockRotate()||Game.m_gameUI.repaint()},IsPaused:function(){return Game.m_paused},Pause:function(){if(Game.m_running)Game.m_paused=!Game.m_paused,Game.m_lastTime=(new Date).getTime()/1E3,Game.m_lastTime=Math.floor(Game.m_lastTime);Game.m_gameUI.repaint()},EnableCheat:function(){Game.m_cheat=!Game.m_cheat},Cheat:function(){if(!Game.m_cheat)return 1;for(var c=0;c<19;c++)for(var a=0;a<10;a++)Game.m_base[a][c]=Game.m_base[a][c+1];return 0},IsGameOver:function(){return Game.m_isGameOver},
Stop:function(){if(!Game.m_effecting){Game.m_running=false;Game.m_paused=false;Game.m_isGameOver=true;Game.m_lastTime=0;Game.m_cumulativeTime=0;Game.m_curBlock=null;clearTimeout(Game.m_downTimer);Game.m_upBaseTimer!=null&&clearTimeout(Game.m_upBaseTimer);for(var c=0;c<10;c++)for(var a=0;a<23;a++)a<20&&(Game.m_ground[c][a]=0),Game.m_base[c][a]=0;Game.m_gameUI.stopedGame()}},Start:function(){Game.m_running=true;Game.m_paused=false;Game.m_isGameOver=false;Game.m_lastTime=0;for(var c=Game.m_cumulativeTime=
0;c<10;c++)for(var a=0;a<23;a++)a<20&&(Game.m_ground[c][a]=0),Game.m_base[c][a]=0;Game.NewCurBlock();Game.m_iScore=0;Game.m_nLevel=Game.m_nInitLevel;Game.m_lastTime=(new Date).getTime()/1E3;Game.m_lastTime=Math.floor(Game.m_lastTime);Game.DownThread()},DownThread:function(){clearTimeout(Game.m_downTimer);if(!Game.m_effecting){var c;Game.IsRunning()&&!Game.IsPaused()?(Game.KeyDownPressed(),c=Game.DEFAULT_DOWN_INTERVAL-Game.GetLevel()*Game.DOWN_INTERVAL_CHANGE):c=Game.DEFAULT_DOWN_INTERVAL;Game.m_downTimer=
setTimeout("Game.DownThread()",c)}},UpBase:function(){if(Game.m_running&&!Game.m_paused){var c=false,a=Game.m_curBlock.GetPos();if(a.x>0&&Game.m_base[a.x-1][a.y-1]>0||Game.m_base[a.x][a.y-1]>0)return false;else if(a.x<9&&Game.m_base[a.x+1][a.y-1]>0)return false;for(a=19;a>=0;a--){for(var e=0;e<10;e++)a==19&&Game.m_base[e][a]>0&&(c=true),a<19&&(m_base[e][a+1]=Game.m_base[e][a]),a==0&&(Game.m_base[e][a]=(e+Game.m_s)%2==1?1:0);if(c)return true}Game.m_s++}return false},SetAutoUp:function(c){if(!Game.m_running)Game.m_isAutoUpBase=
c},isEffecting:function(){return Game.m_effecting},setEffecting:function(c){Game.m_effecting=c}};
